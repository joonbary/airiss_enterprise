<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIRISS v4.0 ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.1/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #FF5722;
            --secondary-color: #F89C26;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #f44336;
            --info-color: #2196F3;
            --dark-color: #1a1a1a;
            --light-bg: #f8f9fa;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, var(--dark-color), #2c2c2c);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2rem;
            color: var(--primary-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .logo .subtitle {
            font-size: 0.9rem;
            color: #ccc;
            margin-top: 5px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success-color);
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-title {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-icon {
            font-size: 1.5rem;
            opacity: 0.7;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-change.positive {
            color: var(--success-color);
        }
        
        .stat-change.negative {
            color: var(--danger-color);
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .table th {
            background: var(--light-bg);
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .table tr:hover {
            background: rgba(255, 87, 34, 0.05);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge.success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }
        
        .badge.warning {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning-color);
        }
        
        .badge.error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }
        
        .refresh-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-button:hover {
            transform: translateY(-2px);
        }
        
        .refresh-button.loading {
            opacity: 0.7;
        }
        
        .refresh-button.loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert.warning {
            background: rgba(255, 152, 0, 0.1);
            border-left: 4px solid var(--warning-color);
            color: #e65100;
        }
        
        .alert.error {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid var(--danger-color);
            color: #c62828;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .container {
                padding: 20px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <div>
                    <h1>AIRISS v4.0 ëª¨ë‹ˆí„°ë§</h1>
                    <div class="subtitle">ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œ</div>
                </div>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>ì‹œìŠ¤í…œ ì •ìƒ</span>
                <button class="refresh-button" onclick="refreshData()" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i>
                    ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ì£¼ìš” ì§€í‘œ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">ì´ ìš”ì²­ ìˆ˜</div>
                    <i class="fas fa-globe stat-icon" style="color: var(--primary-color);"></i>
                </div>
                <div class="stat-value" id="totalRequests">0</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="requestsChange">+12.5%</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">ì˜¤ë¥˜ìœ¨</div>
                    <i class="fas fa-exclamation-triangle stat-icon" style="color: var(--warning-color);"></i>
                </div>
                <div class="stat-value" id="errorRate">0%</div>
                <div class="stat-change" id="errorRateChange">
                    <i class="fas fa-arrow-down"></i>
                    <span>-2.1%</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">í‰ê·  ì‘ë‹µì‹œê°„</div>
                    <i class="fas fa-clock stat-icon" style="color: var(--info-color);"></i>
                </div>
                <div class="stat-value" id="avgResponseTime">0ms</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-down"></i>
                    <span id="responseTimeChange">-15ms</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">í™œì„± ì—°ê²°</div>
                    <i class="fas fa-users stat-icon" style="color: var(--success-color);"></i>
                </div>
                <div class="stat-value" id="activeConnections">0</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="connectionsChange">+5</span>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">CPU ì‚¬ìš©ë¥ </div>
                    <i class="fas fa-microchip stat-icon" style="color: var(--secondary-color);"></i>
                </div>
                <div class="stat-value" id="cpuUsage">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cpuProgress" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </div>
                    <i class="fas fa-memory stat-icon" style="color: var(--info-color);"></i>
                </div>
                <div class="stat-value" id="memoryUsage">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="memoryProgress" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ì˜ì—­ -->
        <div id="alertsContainer"></div>

        <!-- ì°¨íŠ¸ ì˜ì—­ -->
        <div class="chart-grid">
            <div class="chart-card">
                <div class="chart-title">
                    <i class="fas fa-chart-area"></i>
                    ì‹œê°„ë³„ ìš”ì²­ ìˆ˜
                </div>
                <div class="chart-container">
                    <canvas id="requestChart"></canvas>
                </div>
            </div>

            <div class="chart-card">
                <div class="chart-title">
                    <i class="fas fa-chart-pie"></i>
                    ì‘ë‹µ ìƒíƒœ ë¶„í¬
                </div>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì°¨íŠ¸ -->
        <div class="chart-card">
            <div class="chart-title">
                <i class="fas fa-server"></i>
                ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§
            </div>
            <div class="chart-container">
                <canvas id="resourceChart"></canvas>
            </div>
        </div>

        <!-- ìµœê·¼ ì—ëŸ¬ ë¡œê·¸ -->
        <div class="table-container">
            <div class="chart-title">
                <i class="fas fa-bug"></i>
                ìµœê·¼ ì—ëŸ¬ ë¡œê·¸
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>ì‹œê°„</th>
                        <th>íƒ€ì…</th>
                        <th>ë©”ì‹œì§€</th>
                        <th>ê²½ë¡œ</th>
                        <th>ì‹¬ê°ë„</th>
                    </tr>
                </thead>
                <tbody id="errorLogsTable">
                    <tr>
                        <td colspan="5" style="text-align: center; color: #666;">
                            ì—ëŸ¬ ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ì¸ê¸° í˜ì´ì§€ -->
        <div class="table-container" style="margin-top: 20px;">
            <div class="chart-title">
                <i class="fas fa-fire"></i>
                ì¸ê¸° í˜ì´ì§€
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>ê²½ë¡œ</th>
                        <th>ì¡°íšŒìˆ˜</th>
                        <th>ë¹„ìœ¨</th>
                    </tr>
                </thead>
                <tbody id="popularPagesTable">
                    <tr>
                        <td colspan="3" style="text-align: center; color: #666;">
                            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let requestChart = null;
        let statusChart = null;
        let resourceChart = null;
        let isLoading = false;
        let lastUpdateTime = null;

        // ì°¨íŠ¸ ì´ˆê¸°í™”
        function initCharts() {
            // ìš”ì²­ ìˆ˜ ì°¨íŠ¸
            const requestCtx = document.getElementById('requestChart').getContext('2d');
            requestChart = new Chart(requestCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ì‹œê°„ë³„ ìš”ì²­ ìˆ˜',
                        data: [],
                        borderColor: '#FF5722',
                        backgroundColor: 'rgba(255, 87, 34, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });

            // ìƒíƒœ ì½”ë“œ ì°¨íŠ¸
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            statusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['2xx ì„±ê³µ', '3xx ë¦¬ë‹¤ì´ë ‰íŠ¸', '4xx í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜', '5xx ì„œë²„ ì˜¤ë¥˜'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#4CAF50',
                            '#2196F3',
                            '#FF9800',
                            '#f44336'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì°¨íŠ¸
            const resourceCtx = document.getElementById('resourceChart').getContext('2d');
            resourceChart = new Chart(resourceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'CPU %',
                            data: [],
                            borderColor: '#FF5722',
                            backgroundColor: 'rgba(255, 87, 34, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'Memory %',
                            data: [],
                            borderColor: '#2196F3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            borderWidth: 2,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute',
                                displayFormats: {
                                    minute: 'HH:mm'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            if (isLoading) return;
            
            isLoading = true;
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('loading');
            refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨ ì¤‘...';

            try {
                // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('/monitoring/dashboard');
                const data = await response.json();

                if (data.error) {
                    showAlert('error', 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + data.error);
                    return;
                }

                // í†µê³„ ì—…ë°ì´íŠ¸
                updateStats(data);
                
                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                updateCharts(data);
                
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateTables(data);
                
                lastUpdateTime = new Date();
                
            } catch (error) {
                console.error('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                showAlert('error', 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + error.message);
            } finally {
                isLoading = false;
                refreshBtn.classList.remove('loading');
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> ìƒˆë¡œê³ ì¹¨';
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(data) {
            const stats = data.request_stats;
            const system = data.system_metrics;

            document.getElementById('totalRequests').textContent = stats.total.toLocaleString();
            document.getElementById('errorRate').textContent = stats.error_rate + '%';
            document.getElementById('avgResponseTime').textContent = stats.avg_response_time + 'ms';
            document.getElementById('activeConnections').textContent = system.active_connections;
            document.getElementById('cpuUsage').textContent = system.cpu_percent.toFixed(1) + '%';
            document.getElementById('memoryUsage').textContent = system.memory_percent.toFixed(1) + '%';

            // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
            document.getElementById('cpuProgress').style.width = system.cpu_percent + '%';
            document.getElementById('memoryProgress').style.width = system.memory_percent + '%';

            // ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            updateStatColors(stats.error_rate, system.cpu_percent, system.memory_percent);
        }

        // ìƒíƒœ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
        function updateStatColors(errorRate, cpuPercent, memoryPercent) {
            const errorRateChange = document.getElementById('errorRateChange');
            if (errorRate > 5) {
                errorRateChange.className = 'stat-change negative';
                showAlert('warning', `ì˜¤ë¥˜ìœ¨ì´ ${errorRate}%ë¡œ ë†’ìŠµë‹ˆë‹¤.`);
            } else {
                errorRateChange.className = 'stat-change positive';
            }

            // CPU/ë©”ëª¨ë¦¬ ê²½ê³ 
            if (cpuPercent > 80) {
                showAlert('warning', `CPU ì‚¬ìš©ë¥ ì´ ${cpuPercent.toFixed(1)}%ë¡œ ë†’ìŠµë‹ˆë‹¤.`);
            }
            
            if (memoryPercent > 80) {
                showAlert('warning', `ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ${memoryPercent.toFixed(1)}%ë¡œ ë†’ìŠµë‹ˆë‹¤.`);
            }
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts(data) {
            // ì‹œê°„ë³„ ìš”ì²­ ìˆ˜ ì°¨íŠ¸
            if (data.hourly_requests && requestChart) {
                const labels = data.hourly_requests.map(item => item.hour + ':00');
                const requests = data.hourly_requests.map(item => item.requests);
                
                requestChart.data.labels = labels;
                requestChart.data.datasets[0].data = requests;
                requestChart.update();
            }

            // ìƒíƒœ ì½”ë“œ ë¶„í¬ (ìƒ˜í”Œ ë°ì´í„°)
            if (statusChart) {
                const total = data.request_stats.total;
                const failed = data.request_stats.failed;
                const success = total - failed;
                
                statusChart.data.datasets[0].data = [
                    success * 0.9,  // 2xx
                    success * 0.1,  // 3xx
                    failed * 0.7,   // 4xx
                    failed * 0.3    // 5xx
                ];
                statusChart.update();
            }

            // ë¦¬ì†ŒìŠ¤ ì°¨íŠ¸ (ì‹¤ì‹œê°„ ë°ì´í„° ì¶”ê°€)
            if (resourceChart) {
                const now = new Date();
                const timeLabel = now.toISOString();
                
                // ìµœëŒ€ 50ê°œ ë°ì´í„° í¬ì¸íŠ¸ ìœ ì§€
                if (resourceChart.data.labels.length >= 50) {
                    resourceChart.data.labels.shift();
                    resourceChart.data.datasets[0].data.shift();
                    resourceChart.data.datasets[1].data.shift();
                }
                
                resourceChart.data.labels.push(timeLabel);
                resourceChart.data.datasets[0].data.push(data.system_metrics.cpu_percent);
                resourceChart.data.datasets[1].data.push(data.system_metrics.memory_percent);
                resourceChart.update();
            }
        }

        // í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateTables(data) {
            // ì—ëŸ¬ ë¡œê·¸ í…Œì´ë¸”
            const errorLogsTable = document.getElementById('errorLogsTable');
            if (data.recent_errors && data.recent_errors.length > 0) {
                errorLogsTable.innerHTML = data.recent_errors.map(error => `
                    <tr>
                        <td>${new Date(error.timestamp).toLocaleString()}</td>
                        <td><span class="badge error">${error.type}</span></td>
                        <td>${error.message.substring(0, 50)}...</td>
                        <td>${error.path}</td>
                        <td><span class="badge error">ERROR</span></td>
                    </tr>
                `).join('');
            } else {
                errorLogsTable.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: #4CAF50;">
                            <i class="fas fa-check-circle"></i> ìµœê·¼ ì—ëŸ¬ê°€ ì—†ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
            }

            // ì¸ê¸° í˜ì´ì§€ í…Œì´ë¸”
            const popularPagesTable = document.getElementById('popularPagesTable');
            if (data.popular_pages && data.popular_pages.length > 0) {
                const totalHits = data.popular_pages.reduce((sum, page) => sum + page.hits, 0);
                popularPagesTable.innerHTML = data.popular_pages.map(page => `
                    <tr>
                        <td>${page.path}</td>
                        <td>${page.hits.toLocaleString()}</td>
                        <td>${((page.hits / totalHits) * 100).toFixed(1)}%</td>
                    </tr>
                `).join('');
            } else {
                popularPagesTable.innerHTML = `
                    <tr>
                        <td colspan="3" style="text-align: center; color: #666;">
                            ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(type, message) {
            const alertsContainer = document.getElementById('alertsContainer');
            const alertId = 'alert_' + Date.now();
            
            const alertHtml = `
                <div class="alert ${type}" id="${alertId}">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                    ${message}
                </div>
            `;
            
            alertsContainer.insertAdjacentHTML('afterbegin', alertHtml);
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                const alertElement = document.getElementById(alertId);
                if (alertElement) {
                    alertElement.remove();
                }
            }, 5000);
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“Š AIRISS v4.0 ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”');
            
            initCharts();
            refreshData();
            
            // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(refreshData, 30000);
            
            console.log('âœ… ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì¤€ë¹„ ì™„ë£Œ');
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                e.preventDefault();
                refreshData();
            }
        });
    </script>
</body>
</html>